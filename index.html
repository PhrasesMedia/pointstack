<!doctype html>
<html lang="en-AU">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Point Stack</title>
  <meta name="description" content="Point Stack: estimate the cash-out value of Flybuys, Everyday Rewards, Velocity and Amex in AUD." />

  <style>
    :root{
      --bg:#0b0f17;
      --muted:#9ca3af;
      --text:#e5e7eb;
      --border:rgba(255,255,255,0.08);
      --shadow: 0 12px 30px rgba(0,0,0,0.35);
      --radius:16px;
    }
    *{box-sizing:border-box}
    body{
      margin:0;
      min-height:100vh;
      font-family: ui-sans-serif, system-ui, -apple-system, Segoe UI, Roboto, Arial, "Apple Color Emoji","Segoe UI Emoji";
      color:var(--text);
      background: radial-gradient(1200px 700px at 20% 0%, #1f2a44 0%, transparent 60%),
                  radial-gradient(900px 500px at 90% 10%, #2a1f44 0%, transparent 60%),
                  var(--bg);
    }
    .wrap{ max-width:980px; margin:0 auto; padding:22px 18px 48px; position:relative; }

    /* Compact, centered logo header (no box) */
    .headerCentered{
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      gap:10px;
      margin:10px 0 18px;
      text-align:center;
      position:relative;
    }
    /* IMPORTANT: no border/shadow/radius so it blends into background */
    .logoSmall{
      width:240px;
      max-width:70%;
      height:auto;
      display:block;
      border:none;
      border-radius:0;
      box-shadow:none;
    }
    .subtitle{
      margin:0;
      font-size:14px;
      color:rgba(229,231,235,0.75);
      max-width:52ch;
      line-height:1.45;
    }
    .pill{
      position:absolute;
      top:10px;
      right:18px;
      padding:8px 10px;
      border:1px solid var(--border);
      border-radius:999px;
      color:rgba(229,231,235,0.75);
      font-size:12px;
      white-space:nowrap;
      background: rgba(0,0,0,0.18);
      backdrop-filter: blur(6px);
      -webkit-backdrop-filter: blur(6px);
    }

    @media (max-width: 640px){
      .pill{ right:14px; }
    }

    /* ---- Mobile tightening so the Point Stack card sits higher ---- */
    @media (max-width: 520px){
      .wrap{ padding:18px 14px 40px; }

      .headerCentered{
        margin: 6px 0 10px;
        gap: 6px;
      }

      .logoSmall{
        width:180px;
        max-width:78%;
      }

      .subtitle{
        font-size:12.5px;
        line-height:1.35;
        max-width:40ch;
      }

      .converterCard{
        margin-top: 6px;
        padding: 8px;
      }
    }
    /* -------------------------------------------------------------- */

    .card{
      background: linear-gradient(180deg, rgba(255,255,255,0.04), rgba(255,255,255,0.02));
      border:1px solid var(--border);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
      padding:16px;
    }
    .card h2{ margin:0 0 10px 0; font-size:16px; letter-spacing:-0.01em; }

    label{ display:block; color:var(--muted); font-size:12px; margin:12px 0 6px; }
    input, select{
      width:100%;
      padding:12px 12px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(0,0,0,0.22);
      color: var(--text);
      outline:none;
      font-size:14px;
    }
    input:focus, select:focus{ border-color: rgba(255,255,255,0.22); }

    .hint{ color:var(--muted); font-size:12px; margin-top:8px; line-height:1.45; }

    .actions{ display:flex; gap:8px; margin-top:6px; flex-wrap:wrap; }
    button{
      cursor:pointer;
      padding:7px 10px;
      border-radius:12px;
      border:1px solid var(--border);
      background: rgba(255,255,255,0.06);
      color:var(--text);
      font-size:11.5px;
    }
    button:hover{ background: rgba(255,255,255,0.10); }

    .meta{
      display:flex;
      flex-wrap:wrap;
      gap:8px;
      color:var(--muted);
      font-size:11px;
      margin-top:8px;
    }
    .meta span{
      border:1px solid var(--border);
      padding:7px 9px;
      border-radius:999px;
      background: rgba(0,0,0,0.18);
    }

    /* Compact Converter */
    .converterCard{ padding:10px; }
    .converterCard h2{ font-size:13px; margin-bottom:6px; }
    .converterCard label{ font-size:11px; margin:8px 0 4px; }
    .converterCard input, .converterCard select{ padding:9px 10px; font-size:13px; }
    .converterCard .hint{ font-size:10.5px; margin-top:6px; }

    .resultInline{
      margin-top:10px;
      display:flex;
      align-items:flex-end;
      justify-content:space-between;
      gap:10px;
      flex-wrap:wrap;
    }
    .resultInline .label{ color:var(--muted); font-size:11px; }
    .resultInline .value{ font-size:22px; font-weight:700; letter-spacing:-0.02em; }

    /* ===== Point Stack card ===== */
    .stackCardWrap{ margin-top:12px; }
    .stackCard{
      position:relative;
      overflow:hidden;
      border-radius:18px;
      border:1px solid rgba(255,255,255,0.14);
      box-shadow: 0 26px 60px rgba(0,0,0,0.55), inset 0 1px 0 rgba(255,255,255,0.12);
      padding:18px 18px 16px;
      background:
        radial-gradient(700px 220px at 10% 0%, rgba(255,255,255,0.12), transparent 60%),
        radial-gradient(700px 280px at 90% 100%, rgba(255,255,255,0.10), transparent 55%),
        linear-gradient(135deg, #a3162a 0%, #d11d37 35%, #a3162a 70%, #7e0f22 100%);
      min-height:150px;
    }
    .stackCard::before{
      content:"";
      position:absolute;
      inset:-40px -60px auto auto;
      width:220px;
      height:220px;
      border-radius:999px;
      background: radial-gradient(circle at 30% 30%, rgba(255,255,255,0.25), rgba(255,255,255,0.06) 55%, transparent 70%);
      transform: rotate(10deg);
      pointer-events:none;
    }
    .stackCard::after{
      content:"";
      position:absolute;
      inset:0;
      pointer-events:none;
      background:
        radial-gradient(circle at 78% 18%, rgba(255,255,255,0.28), transparent 18%),
        radial-gradient(circle at 84% 24%, rgba(255,255,255,0.22), transparent 16%),
        radial-gradient(circle at 90% 14%, rgba(255,255,255,0.18), transparent 14%),
        linear-gradient(115deg,
          transparent 0%,
          rgba(255,255,255,0.10) 28%,
          rgba(255,255,255,0.18) 33%,
          rgba(255,255,255,0.06) 38%,
          transparent 60%);
      mix-blend-mode: screen;
      opacity:0.38;
    }

    .stackTop{ position:relative; z-index:1; }
    .stackBrand{ display:flex; flex-direction:column; gap:4px; }
    .stackBrandName{ font-weight:700; letter-spacing:0.06em; text-transform:uppercase; font-size:13px; opacity:0.95; }
    .stackTagline{ font-size:12px; color: rgba(255,255,255,0.84); opacity:0.95; }

    .stackMid{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:14px;
      margin-top:14px;
      position:relative;
      z-index:1;
    }
    .chip{
      width:44px; height:34px; border-radius:8px;
      background:
        linear-gradient(135deg, rgba(255,255,255,0.35), rgba(255,255,255,0.08)),
        linear-gradient(135deg, #f6d98f 0%, #d7aa4a 35%, #b57f22 70%, #f0d27a 100%);
      border:1px solid rgba(255,255,255,0.22);
      box-shadow: inset 0 1px 0 rgba(255,255,255,0.35), 0 10px 18px rgba(0,0,0,0.25);
      position:relative;
      flex:0 0 auto;
    }
    .chip:before{
      content:"";
      position:absolute; inset:0;
      border-radius:8px;
      background: linear-gradient(120deg, transparent 10%, rgba(255,255,255,0.25) 35%, transparent 60%);
      opacity:0.35;
    }
    .chip:after{
      content:"";
      position:absolute;
      left:7px; right:7px; top:10px; height:2px;
      background: rgba(0,0,0,0.18);
      border-radius:999px;
    }

    .stackDigits{
      flex: 1 1 auto;
      display:flex;
      gap:14px;
      justify-content:center;
      font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", monospace;
      letter-spacing:0.14em;
      font-size:14px;
      opacity:0.95;
      color: rgba(255,255,255,0.92);
      user-select:none;
    }

    .stackAmountBlock{ text-align:right; flex: 0 0 auto; min-width: 140px; }
    .stackAmountLabel{
      font-size:11px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,0.82);
    }
    .stackAmount{
      font-size:28px;
      font-weight:700;
      letter-spacing:-0.02em;
      margin-top:2px;
      color: rgba(255,255,255,0.98);
    }

    .stackBreakdown{
      margin-top:10px;
      position:relative;
      z-index:1;
      width: min(360px, 72%);
      padding-left: 56px;
      display:flex;
      flex-direction:column;
      gap:6px;
      color: rgba(255,255,255,0.90);
      font-size:12px;
      line-height:1.2;
    }
    .stackBreakdown .item{
      display:flex;
      align-items:center;
      justify-content:space-between;
      gap:12px;
      padding:6px 10px;
      border-radius:12px;
      border:1px solid rgba(255,255,255,0.14);
      background: rgba(0,0,0,0.14);
      backdrop-filter: blur(4px);
      -webkit-backdrop-filter: blur(4px);
    }
    .stackBreakdown .name{
      opacity:0.95;
      white-space:nowrap;
      overflow:hidden;
      text-overflow:ellipsis;
      max-width: 240px;
    }
    .stackBreakdown .val{
      font-weight:800;
      white-space:nowrap;
      opacity:0.98;
    }

    .stackBottom{
      display:flex;
      justify-content:space-between;
      gap:12px;
      margin-top:12px;
      align-items:flex-end;
      position:relative;
      z-index:1;
    }
    .stackMeta{
      display:flex;
      flex-direction:column;
      gap:4px;
      color: rgba(255,255,255,0.84);
      font-size:12px;
    }
    .stackBadge{
      padding:8px 12px;
      border-radius:999px;
      border:1px solid rgba(255,255,255,0.22);
      background: rgba(0,0,0,0.20);
      font-size:12px;
      letter-spacing:0.08em;
      text-transform:uppercase;
      color: rgba(255,255,255,0.92);
      align-self:flex-end;
      white-space:nowrap;
    }

    @media (max-width: 520px){
      .stackDigits{ display:none; }
      .stackAmount{ font-size:26px; }
      .stackMid{ align-items:flex-start; }
      .stackAmountBlock{ min-width:unset; }
      .stackBreakdown{ width: 100%; padding-left: 0; }
    }

    /* Rates table */
    .table{ width:100%; border-collapse:collapse; margin-top:10px; font-size:13px; }
    .table th, .table td{
      text-align:left;
      padding:10px 8px;
      border-bottom:1px solid var(--border);
      vertical-align:top;
    }
    .table th{ color:var(--muted); font-weight:600; font-size:12px; }

    footer{ margin-top:16px; color:var(--muted); font-size:12px; line-height:1.45; }
  </style>
</head>

<body>
  <div class="wrap">
    <div class="pill">AUD • cash-out</div>

    <header class="headerCentered">
      <img class="logoSmall" src="Point Stack.png" alt="Point Stack" />
      <p class="subtitle">Cash-out estimate + saved balances (stored locally in your browser).</p>
    </header>

    <!-- Ultra-compact converter -->
    <section class="card converterCard">
      <h2>Converter</h2>

      <label for="program">Program</label>
      <select id="program"></select>

      <label id="amountLabel" for="amountInput">Points</label>
      <input id="amountInput" type="text" inputmode="decimal" placeholder="e.g. 50,000" />

      <p class="hint" id="hintText">
        Tip: Commas work (e.g. <b>120,000</b>). Switching programs loads your saved balance.
      </p>

      <div class="resultInline">
        <div>
          <div class="label" id="resultLabel">Cash-out</div>
          <div class="value" id="resultValue">$0.00</div>
        </div>

        <div class="meta" style="margin:0;">
          <span id="metaAmount">0 points</span>
          <span id="metaRate">Rate: —</span>
        </div>
      </div>

      <div class="actions">
        <button id="copyBtn" type="button">Copy result</button>
        <button id="resetCalcBtn" type="button">Reset</button>
      </div>
    </section>

    <!-- Point Stack Card -->
    <div class="stackCardWrap" aria-label="Total cash-out across all programs">
      <div class="stackCard">
        <div class="stackTop">
          <div class="stackBrand">
            <div class="stackBrandName">POINT STACK</div>
            <div class="stackTagline">Total cash-out across all programs</div>
          </div>
        </div>

        <div class="stackMid">
          <div class="chip" aria-hidden="true"></div>

          <div class="stackDigits" aria-hidden="true">
            <span>1234</span><span>5678</span><span>9012</span><span>3456</span>
          </div>

          <div class="stackAmountBlock">
            <div class="stackAmountLabel">TOTAL CASH-OUT</div>
            <div class="stackAmount" id="totalCashoutStack">$0.00</div>
          </div>
        </div>

        <div class="stackBreakdown" id="stackBreakdown" aria-label="Cash-out breakdown"></div>

        <div class="stackBottom">
          <div class="stackMeta">
            <div id="lastUpdatedText">Last updated: —</div>
            <div>Currency: AUD</div>
          </div>

          <div class="stackBadge">CASH</div>
        </div>
      </div>
    </div>

    <!-- Rates -->
    <section class="card" style="margin-top:14px;">
      <h2>Rates used</h2>
      <p class="subtitle" style="margin-top:-6px;">
        Everyday Rewards is treated as a cash balance. The other programs use fixed cash-equivalent rates.
      </p>

      <table class="table">
        <thead>
          <tr>
            <th>Program</th>
            <th>Cash-out rate</th>
            <th>Notes</th>
          </tr>
        </thead>
        <tbody id="ratesBody"></tbody>
      </table>

      <footer>These are cash-equivalent estimates for quick comparison.</footer>
    </section>
  </div>

  <script>
    const PROGRAMS = {
      flybuys: {
        name: "Flybuys",
        type: "points",
        dollarsPerPoint: 0.005,
        note: "Cash-equivalent estimate per point."
      },
      everyday_rewards: {
        name: "Woolworths Everyday Rewards",
        type: "cash",
        dollarsPerPoint: null,
        note: "Cash balance (AUD). No conversion."
      },
      velocity: {
        name: "Velocity Frequent Flyer",
        type: "points",
        dollarsPerPoint: 0.003,
        note: "Cash-equivalent estimate per point."
      },
      amex_mr: {
        name: "Amex Membership Rewards",
        type: "points",
        dollarsPerPoint: 0.005,
        note: "Cash-equivalent estimate per point."
      }
    };

    const STORAGE_KEY = "point_stack_balances_v15_mobile_tight";

    const programEl = document.getElementById('program');
    const amountLabelEl = document.getElementById('amountLabel');
    const amountInputEl = document.getElementById('amountInput');

    const resultValueEl = document.getElementById('resultValue');
    const resultLabelEl = document.getElementById('resultLabel');
    const metaAmountEl = document.getElementById('metaAmount');
    const metaRateEl = document.getElementById('metaRate');

    const copyBtn = document.getElementById('copyBtn');
    const resetCalcBtn = document.getElementById('resetCalcBtn');

    const ratesBody = document.getElementById('ratesBody');

    const lastUpdatedTextEl = document.getElementById('lastUpdatedText');
    const totalCashoutStackEl = document.getElementById('totalCashoutStack');
    const stackBreakdownEl = document.getElementById('stackBreakdown');

    function formatMoney(amount){
      return new Intl.NumberFormat("en-AU", {
        style: "currency",
        currency: "AUD",
        minimumFractionDigits: 2,
        maximumFractionDigits: 2
      }).format(amount || 0);
    }
    function formatNumber(n){ return new Intl.NumberFormat("en-AU").format(n); }

    function parsePoints(input){
      const cleaned = String(input).replace(/[,\s]/g, '');
      if(!cleaned) return 0;
      const num = Number(cleaned);
      return Number.isFinite(num) && num > 0 ? Math.floor(num) : 0;
    }
    function parseMoney(input){
      const cleaned = String(input).replace(/[$,\s]/g, '');
      if(!cleaned) return 0;
      const num = Number(cleaned);
      if(!Number.isFinite(num) || num <= 0) return 0;
      return Math.round(num * 100) / 100;
    }

    function rateToText(dollarsPerPoint){
      const centsPerPoint = dollarsPerPoint * 100;
      const cents = (Math.round(centsPerPoint * 1000) / 1000);
      return `${cents}¢/point`;
    }

    function cashoutFor(programKey, balanceValue){
      const p = PROGRAMS[programKey];
      if(!p) return 0;
      if(p.type === "cash") return balanceValue || 0;
      return (balanceValue || 0) * (p.dollarsPerPoint || 0);
    }

    function defaultBalances(){
      const obj = {};
      for(const k of Object.keys(PROGRAMS)) obj[k] = 0;
      return obj;
    }

    function loadBalances(){
      try{
        const raw = localStorage.getItem(STORAGE_KEY);
        if(!raw) return defaultBalances();
        const parsed = JSON.parse(raw);
        const merged = defaultBalances();
        for(const [k, p] of Object.entries(PROGRAMS)){
          merged[k] = (p.type === "cash") ? parseMoney(parsed?.[k] ?? 0) : parsePoints(parsed?.[k] ?? 0);
        }
        return merged;
      }catch(e){
        return defaultBalances();
      }
    }

    function saveBalancesNow(){
      localStorage.setItem(STORAGE_KEY, JSON.stringify(BALANCES));
    }

    let BALANCES = loadBalances();

    function populateProgramDropdown(){
      programEl.innerHTML = "";
      for(const [key, cfg] of Object.entries(PROGRAMS)){
        const opt = document.createElement("option");
        opt.value = key;
        opt.textContent = cfg.name;
        programEl.appendChild(opt);
      }
      programEl.value = "flybuys";
    }

    function renderRateTable(){
      ratesBody.innerHTML = "";
      for(const cfg of Object.values(PROGRAMS)){
        const tr = document.createElement("tr");

        const tdName = document.createElement("td");
        tdName.textContent = cfg.name;

        const tdRate = document.createElement("td");
        tdRate.textContent = (cfg.type === "cash") ? "— (cash)" : rateToText(cfg.dollarsPerPoint);

        const tdNote = document.createElement("td");
        tdNote.textContent = cfg.note;

        tr.appendChild(tdName);
        tr.appendChild(tdRate);
        tr.appendChild(tdNote);
        ratesBody.appendChild(tr);
      }
    }

    function updateLastUpdated(){
      const d = new Date();
      const formatted = d.toLocaleString("en-AU", {
        year: "numeric",
        month: "short",
        day: "2-digit",
        hour: "2-digit",
        minute: "2-digit"
      });
      lastUpdatedTextEl.textContent = `Last updated: ${formatted}`;
    }

    function updateTotalCashout(){
      let total = 0;
      for(const [k, v] of Object.entries(BALANCES)){
        total += cashoutFor(k, v);
      }
      totalCashoutStackEl.textContent = formatMoney(total);
    }

    function updateStackBreakdown(){
      const items = [];
      for(const [k, cfg] of Object.entries(PROGRAMS)){
        const bal = BALANCES[k] || 0;
        const cashout = cashoutFor(k, bal);
        if(cashout > 0.00001){
          const tooltip = cfg.type === "cash"
            ? `${cfg.name}: ${formatMoney(bal)} balance`
            : `${cfg.name}: ${formatNumber(bal)} points @ ${rateToText(cfg.dollarsPerPoint)}`;
          items.push({ name: cfg.name, val: formatMoney(cashout), tooltip, cashout });
        }
      }

      items.sort((a,b) => b.cashout - a.cashout);

      stackBreakdownEl.innerHTML = "";
      if(items.length === 0) return;

      for(const it of items){
        const div = document.createElement("div");
        div.className = "item";
        div.title = it.tooltip;
        div.innerHTML = `<span class="name">${it.name}</span><span class="val">${it.val}</span>`;
        stackBreakdownEl.appendChild(div);
      }
    }

    function setCalculatorUIForProgram(){
      const key = programEl.value;
      const cfg = PROGRAMS[key];

      if(cfg.type === "cash"){
        amountLabelEl.textContent = "Cash amount (AUD)";
        amountInputEl.placeholder = "e.g. $25.00";
        amountInputEl.inputMode = "decimal";
        document.getElementById("hintText").innerHTML =
          `Tip: Enter a cash balance (e.g. <b>$25</b>). Switching programs loads your saved balance.`;
      }else{
        amountLabelEl.textContent = "Points";
        amountInputEl.placeholder = "e.g. 50,000";
        amountInputEl.inputMode = "numeric";
        document.getElementById("hintText").innerHTML =
          `Tip: Commas work (e.g. <b>120,000</b>). Switching programs loads your saved balance.`;
      }
    }

    function setCalculatorInputFromSaved(){
      const key = programEl.value;
      const cfg = PROGRAMS[key];
      const saved = BALANCES[key] || 0;

      amountInputEl.value = (cfg.type === "cash")
        ? (saved ? String(saved.toFixed(2)) : "")
        : (saved ? formatNumber(saved) : "");
    }

    function updateCalculator(overrideFromSaved=false){
      const key = programEl.value;
      const cfg = PROGRAMS[key];

      setCalculatorUIForProgram();
      if(overrideFromSaved) setCalculatorInputFromSaved();

      const raw = amountInputEl.value;
      const balanceVal = (cfg.type === "cash") ? parseMoney(raw) : parsePoints(raw);
      const value = cashoutFor(key, balanceVal);

      resultLabelEl.textContent = `${cfg.name} cash-out`;
      resultValueEl.textContent = formatMoney(value);

      if(cfg.type === "cash"){
        metaAmountEl.textContent = formatMoney(balanceVal) + " balance";
        metaRateEl.textContent = "Rate: 1:1 cash";
      }else{
        metaAmountEl.textContent = `${formatNumber(balanceVal)} points`;
        metaRateEl.textContent = `Rate: ${rateToText(cfg.dollarsPerPoint)}`;
      }
    }

    async function copyToClipboard(text){
      try{
        await navigator.clipboard.writeText(text);
        return true;
      }catch(e){
        const ta = document.createElement("textarea");
        ta.value = text;
        document.body.appendChild(ta);
        ta.select();
        document.execCommand("copy");
        ta.remove();
        return true;
      }
    }

    programEl.addEventListener('change', () => {
      updateCalculator(true);
    });

    amountInputEl.addEventListener('input', () => {
      updateCalculator(false);

      const key = programEl.value;
      const cfg = PROGRAMS[key];
      const newVal = (cfg.type === "cash") ? parseMoney(amountInputEl.value) : parsePoints(amountInputEl.value);
      BALANCES[key] = newVal;

      updateTotalCashout();
      updateStackBreakdown();
      updateLastUpdated();

      clearTimeout(amountInputEl._saveTimer);
      amountInputEl._saveTimer = setTimeout(() => saveBalancesNow(), 300);
    });

    copyBtn.addEventListener('click', async () => {
      const text = `${resultLabelEl.textContent}: ${resultValueEl.textContent} (${metaAmountEl.textContent}, ${metaRateEl.textContent})`;
      await copyToClipboard(text);
      copyBtn.textContent = "Copied!";
      setTimeout(() => copyBtn.textContent = "Copy result", 900);
    });

    resetCalcBtn.addEventListener('click', () => {
      amountInputEl.value = "";
      updateCalculator(false);
      amountInputEl.focus();
    });

    // Init
    populateProgramDropdown();
    renderRateTable();
    updateCalculator(true);
    updateTotalCashout();
    updateStackBreakdown();
    updateLastUpdated();
  </script>
</body>
</html>
